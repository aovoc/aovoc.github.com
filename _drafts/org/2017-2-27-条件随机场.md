
# Table of Contents

1.  [概率无向图模型](#orgee522d5)
    1.  [模型定义](#org0dde92d)
    2.  [概率无向图的因式分解](#org4ca8859)
2.  [条件随机场的定义和形式](#org8e3515a)
    1.  [条件随机场的定义](#org6b438bc)
    2.  [条件随机场的参数化形式](#org6437a32)
    3.  [条件随机场的简化形式](#org86c6352)
    4.  [条件随机场的矩阵形式](#orgc1806ff)
3.  [条件随机场的概率计算问题](#org852f08c)
    1.  [前向-后向算法](#org9b4fa8b)
    2.  [概率计算](#orgc2e331f)
    3.  [期望值计算](#org6e93054)
4.  [条件随机场的学习算法](#org0c12d86)
    1.  [改进的迭代尺度法](#orge366cf6)
    2.  [拟牛顿法](#orgd48cd8b)
5.  [条件随机场的预测算法](#org0a46352)

条件随机场(CRF)是给定一组输入随机变量条件下另一组输出随机变量的条件概率分布模型。
特点：假设输出随机变量构成马尔科夫随机场。
主要讲述线性链条件随机场


<a id="orgee522d5"></a>

# 概率无向图模型

又称为马尔科夫随机场，可以由无向图表示的联合概率分布。


<a id="org0dde92d"></a>

## 模型定义

无向图表示的随机变量之间存在成对马尔科夫性、局部马尔可夫性、全局马尔科夫性。
成对马尔可夫性：u,v是没有边连接的结点，O是其他结点，给定随机变量组 <img src="ltximg/2017-2-27-条件随机场_4a831fbef4abf7e0cd7968b6458561d7c8632fe1.png" alt="2017-2-27-条件随机场_4a831fbef4abf7e0cd7968b6458561d7c8632fe1.png" /> 的条件下随机变量 <img src="ltximg/2017-2-27-条件随机场_c94f8838a6534d5a2711efde75ccda99471d718f.png" alt="2017-2-27-条件随机场_c94f8838a6534d5a2711efde75ccda99471d718f.png" /> 和 <img src="ltximg/2017-2-27-条件随机场_73b9ae721c423f44c19762be3a2807416ae46d88.png" alt="2017-2-27-条件随机场_73b9ae721c423f44c19762be3a2807416ae46d88.png" /> 是条件独立的。
局部马尔可夫性：W是与v有边连接的结点，O是其他结点，给定随机变量组 <img src="ltximg/2017-2-27-条件随机场_6a97cc585aa41dad97931ec4a2a1c3a2ef4c679c.png" alt="2017-2-27-条件随机场_6a97cc585aa41dad97931ec4a2a1c3a2ef4c679c.png" /> 的条件下随机变量 <img src="ltximg/2017-2-27-条件随机场_73b9ae721c423f44c19762be3a2807416ae46d88.png" alt="2017-2-27-条件随机场_73b9ae721c423f44c19762be3a2807416ae46d88.png" /> 和 <img src="ltximg/2017-2-27-条件随机场_4a831fbef4abf7e0cd7968b6458561d7c8632fe1.png" alt="2017-2-27-条件随机场_4a831fbef4abf7e0cd7968b6458561d7c8632fe1.png" /> 是条件独立的。
全局马尔可夫性：点集合A,B是被C分开的任意结点集合，给定随机变量组 <img src="ltximg/2017-2-27-条件随机场_fbf8b5564fb3243b6330a9af4de350e34c699f7d.png" alt="2017-2-27-条件随机场_fbf8b5564fb3243b6330a9af4de350e34c699f7d.png" /> 的条件下随机变量组 <img src="ltximg/2017-2-27-条件随机场_cb82b849e9b26b702b5333d4b4ea30eb856178c3.png" alt="2017-2-27-条件随机场_cb82b849e9b26b702b5333d4b4ea30eb856178c3.png" /> 和 <img src="ltximg/2017-2-27-条件随机场_c29ed803e6c6a636cb6723164005f7054ae7f93c.png" alt="2017-2-27-条件随机场_c29ed803e6c6a636cb6723164005f7054ae7f93c.png" /> 是条件独立的。

概率无向图模型定义：
结点表示随机变量，边表示依赖关系。若联合概率分布P(Y)满足成对马尔可夫性、局部马尔可夫性、全局马尔可夫性，就称此联合概率分布为概率无向图模型，或马尔科夫随机场。
求解马尔科夫模型：将联合概率进行因式分解。


<a id="org4ca8859"></a>

## 概率无向图的因式分解

定义团和最大团
概率无向图的因式分解：将无向图模型的概率分布表示为最大团上的随机变量函数的乘积形式
给定无向图概率模型，设其无向图为G，C为G上的最大团，<img src="ltximg/2017-2-27-条件随机场_fbf8b5564fb3243b6330a9af4de350e34c699f7d.png" alt="2017-2-27-条件随机场_fbf8b5564fb3243b6330a9af4de350e34c699f7d.png" /> 表示C对应的随机变量。那么概率无向图模型的联合概率分布P(Y)可写作图中所有最大团C上的函数 <img src="ltximg/2017-2-27-条件随机场_8862280522686b44956b276f3b5c4f7c2897543d.png" alt="2017-2-27-条件随机场_8862280522686b44956b276f3b5c4f7c2897543d.png" /> 的乘积形式，即
<img src="ltximg/2017-2-27-条件随机场_f236d194d06a12cc480bc131e253f0b1f8b4d068.png" alt="2017-2-27-条件随机场_f236d194d06a12cc480bc131e253f0b1f8b4d068.png" /> 
其中， Z是规范化因子，由式
<img src="ltximg/2017-2-27-条件随机场_03cb43782a39c196d4af28da551eb0ee0ee2b714.png" alt="2017-2-27-条件随机场_03cb43782a39c196d4af28da551eb0ee0ee2b714.png" /> 
给出。保证P(Y)构成一个概率分布。函数 <img src="ltximg/2017-2-27-条件随机场_8862280522686b44956b276f3b5c4f7c2897543d.png" alt="2017-2-27-条件随机场_8862280522686b44956b276f3b5c4f7c2897543d.png" /> 称为势函数，要求势函数严格为正。


<a id="org8e3515a"></a>

# 条件随机场的定义和形式


<a id="org6b438bc"></a>

## 条件随机场的定义

条件随机场（CRF）是给定随机变量X的条件下，随机变量Y的马尔科夫随机场。
线性链条件随机场： 用于标注等问题
   条件概率模型P(Y|X)，Y是输出变量（状态序列）， X是输入变量（观测序列）。学习时，通过（正则化）极大似然估计得到条件概率P(Y|X)。预测时，对于给定的输入序列x,求出条件概率 <img src="ltximg/2017-2-27-条件随机场_4a35f0675648b167bc58593e26cc84b0183589ab.png" alt="2017-2-27-条件随机场_4a35f0675648b167bc58593e26cc84b0183589ab.png" /> 最大的输出序列 <img src="ltximg/2017-2-27-条件随机场_60b47932d78a19e4e3a3f2edab1d0a74fc1b64b6.png" alt="2017-2-27-条件随机场_60b47932d78a19e4e3a3f2edab1d0a74fc1b64b6.png" /> .
   条件随机场的定义
   设X与Y是随机变量，P(Y|X)是在给定X的条件下Y的条件概率分布，若随机变量Y构成一个由无向图G=(V,E)表示的马尔科夫随机场，则称条件概率分布P(Y|X)为条件随机场。
   定义中未要求X和Y有相同的结构，现实中一般假设有相同的图结构。

线性链条件随机场的定义
设 <img src="ltximg/2017-2-27-条件随机场_299fdd039b942f17e3b8f26533ba8b0b4ca64a8e.png" alt="2017-2-27-条件随机场_299fdd039b942f17e3b8f26533ba8b0b4ca64a8e.png" /> ， <img src="ltximg/2017-2-27-条件随机场_39325e970b788748a30248f0fe10513fb2f41622.png" alt="2017-2-27-条件随机场_39325e970b788748a30248f0fe10513fb2f41622.png" /> 均为线性链表示的条件随机序列，若给定条件随机序列X的条件下，随机变量序列Y的条件分布序列 <img src="ltximg/2017-2-27-条件随机场_723307fd51f606cf46f7fdc012dbc985bc14657c.png" alt="2017-2-27-条件随机场_723307fd51f606cf46f7fdc012dbc985bc14657c.png" /> 构成条件随机场，即满足马尔可夫性，则称P(Y|X)为线性链条件随机场。


<a id="org6437a32"></a>

## 条件随机场的参数化形式

设P(Y|X)为线性链条件随机场，则在随机变量X取值为x的条件下，随机变量Y取值为y的条件概率具有如下形式：
<img src="ltximg/2017-2-27-条件随机场_3d0a7a44223b03e0d733263c7854ef64a51768e5.png" alt="2017-2-27-条件随机场_3d0a7a44223b03e0d733263c7854ef64a51768e5.png" /> 
其中，
<img src="ltximg/2017-2-27-条件随机场_990f59c1577641ab274dcb428d9f239d7dd5ded2.png" alt="2017-2-27-条件随机场_990f59c1577641ab274dcb428d9f239d7dd5ded2.png" />
<img src="ltximg/2017-2-27-条件随机场_4471d55b568a72cc7e720c1652ae059efa574c6a.png" alt="2017-2-27-条件随机场_4471d55b568a72cc7e720c1652ae059efa574c6a.png" /> 为转移特征，  <img src="ltximg/2017-2-27-条件随机场_468ad6c3d81dfe7c69c83167f6ccfee98dac528e.png" alt="2017-2-27-条件随机场_468ad6c3d81dfe7c69c83167f6ccfee98dac528e.png" /> 为状态特征，取值为0或者1； <img src="ltximg/2017-2-27-条件随机场_aad0f9d9fa1a208c2031d830b4023b6190e85744.png" alt="2017-2-27-条件随机场_aad0f9d9fa1a208c2031d830b4023b6190e85744.png" /> 为对应的权值。
例11.1    1+ 0.2 + 1 + 0.5 + 0.5 = 3.2


<a id="org86c6352"></a>

## 条件随机场的简化形式

同一特征在各个位置都有定义，对同一特征在各个位置求和，将局部特征函数转化成一个全局特征函数，将条件随机场写成权值向量和特征向量的内积形式。
先将转移特征和状态特征用统一的符号 <img src="ltximg/2017-2-27-条件随机场_d1d74a100b20d3994d937a0cc9c550d152c20243.png" alt="2017-2-27-条件随机场_d1d74a100b20d3994d937a0cc9c550d152c20243.png" /> 表示。
然后，对转移和状态特征在各个位置上求和。
接着用统一的符号 <img src="ltximg/2017-2-27-条件随机场_fb66f8c89dcbb64abffbe441745e539d03dee7ba.png" alt="2017-2-27-条件随机场_fb66f8c89dcbb64abffbe441745e539d03dee7ba.png" /> 表示特征 <img src="ltximg/2017-2-27-条件随机场_1c58a3acadc74c87c7e8a525bc08ec129d499255.png" alt="2017-2-27-条件随机场_1c58a3acadc74c87c7e8a525bc08ec129d499255.png" /> 的权值。
于是，条件随机场可以表示为：
<img src="ltximg/2017-2-27-条件随机场_1b068b4513c0f32aab6b2af3f4aa07f68b4d84a1.png" alt="2017-2-27-条件随机场_1b068b4513c0f32aab6b2af3f4aa07f68b4d84a1.png" />
<img src="ltximg/2017-2-27-条件随机场_b2477891ee5d3d224aea12fb6874c2a3d7085875.png" alt="2017-2-27-条件随机场_b2477891ee5d3d224aea12fb6874c2a3d7085875.png" />
若以向量表示为：
<img src="ltximg/2017-2-27-条件随机场_a273e0e6a16daf3c5f2a2b101853cf76d1141721.png" alt="2017-2-27-条件随机场_a273e0e6a16daf3c5f2a2b101853cf76d1141721.png" />


<a id="orgc1806ff"></a>

## 条件随机场的矩阵形式


<a id="org852f08c"></a>

# 条件随机场的概率计算问题

给定条件随机场P(Y|X),输入序列x和输出序列y,计算条件概率 <img src="ltximg/2017-2-27-条件随机场_7b966ea6915e248b4b60fd42d7d3353e83ab5ccd.png" alt="2017-2-27-条件随机场_7b966ea6915e248b4b60fd42d7d3353e83ab5ccd.png" /> 以及相应的数学期望的问题。


<a id="org9b4fa8b"></a>

## 前向-后向算法

定义前向变量 <img src="ltximg/2017-2-27-条件随机场_cdbf14c6301edd02f022392ef5a754385c3be19e.png" alt="2017-2-27-条件随机场_cdbf14c6301edd02f022392ef5a754385c3be19e.png" /> , <img src="ltximg/2017-2-27-条件随机场_137bbad0b3ef42cb4591d7f38ca892952e9740e9.png" alt="2017-2-27-条件随机场_137bbad0b3ef42cb4591d7f38ca892952e9740e9.png" /> 表示在位置i的标记是 <img src="ltximg/2017-2-27-条件随机场_74eddcc60ec92ca5a89ba849486ccde9dcbe5a2a.png" alt="2017-2-27-条件随机场_74eddcc60ec92ca5a89ba849486ccde9dcbe5a2a.png" /> 并且到位置i 的前部分标记序列的非规范化概率。 <img src="ltximg/2017-2-27-条件随机场_74eddcc60ec92ca5a89ba849486ccde9dcbe5a2a.png" alt="2017-2-27-条件随机场_74eddcc60ec92ca5a89ba849486ccde9dcbe5a2a.png" /> 可取m个， <img src="ltximg/2017-2-27-条件随机场_cdbf14c6301edd02f022392ef5a754385c3be19e.png" alt="2017-2-27-条件随机场_cdbf14c6301edd02f022392ef5a754385c3be19e.png" /> 是m维向量。
定义后向变量 <img src="ltximg/2017-2-27-条件随机场_3bcb4c9e9afccda014003b22d3b9f310810c644c.png" alt="2017-2-27-条件随机场_3bcb4c9e9afccda014003b22d3b9f310810c644c.png" /> , <img src="ltximg/2017-2-27-条件随机场_ba379713b6883ffe40af14fd42ab81dfcb64cea1.png" alt="2017-2-27-条件随机场_ba379713b6883ffe40af14fd42ab81dfcb64cea1.png" /> 表示在位置i的标记为 <img src="ltximg/2017-2-27-条件随机场_74eddcc60ec92ca5a89ba849486ccde9dcbe5a2a.png" alt="2017-2-27-条件随机场_74eddcc60ec92ca5a89ba849486ccde9dcbe5a2a.png" /> 并且从 i+1 到 n的后部分标记序列的非规范化概率。

可得：
<img src="ltximg/2017-2-27-条件随机场_38bf0e0c7849d2edd0c0a8f5ed87f8d3c18cb666.png" alt="2017-2-27-条件随机场_38bf0e0c7849d2edd0c0a8f5ed87f8d3c18cb666.png" />


<a id="orgc2e331f"></a>

## 概率计算

<img src="ltximg/2017-2-27-条件随机场_f8adc3cc7ceef2b33a32e7a2c9e1bf1594184a61.png" alt="2017-2-27-条件随机场_f8adc3cc7ceef2b33a32e7a2c9e1bf1594184a61.png" />
  <img src="ltximg/2017-2-27-条件随机场_06c8cb55f6aafddac4306fc0d7f2490044ce97c4.png" alt="2017-2-27-条件随机场_06c8cb55f6aafddac4306fc0d7f2490044ce97c4.png" />


<a id="org6e93054"></a>

## 期望值计算


<a id="org0c12d86"></a>

# 条件随机场的学习算法

模型：定义在时序数据上的对数线性模型
学习方法：（正则化的）极大似然估计


<a id="orge366cf6"></a>

## 改进的迭代尺度法


<a id="orgd48cd8b"></a>

## 拟牛顿法


<a id="org0a46352"></a>

# 条件随机场的预测算法

维特比算法

